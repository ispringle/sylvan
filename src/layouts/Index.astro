---
import IndexCard from "@components/IndexCard.astro"
import {filterByDir, filterIndices, sortNewestToOldest } from "@utils/filterContent";
import { allPages } from "@lib/pages";

const { page, ...props } = Astro.props;
const { frontmatter, file } = page;


const includeRoll = frontmatter?.include_roll || typeof frontmatter?.include_roll === "undefined"
const rollDir = frontmatter.rollDir || frontmatter.roll_dir;
const ROLL_DIR_REGEX = new RegExp(`${rollDir}\/.*\.[(org)|(md)|(mdx)]`);
const roll = (await allPages)
               .filter(filterIndices)
               .filter(filterByDir(ROLL_DIR_REGEX))
---
<style>
  .cards {
    column-width: 15rem;
  }
</style>
<article class="main index">
  <slot />
</article>
{ includeRoll
  ? <section>
        <h2>{frontmatter?.roll_heading ? frontmatter.roll_heading : "Pages"}</h2>
        <article class="cards">{
            roll.map((card) => (
            <IndexCard card={card}> </IndexCard>
            ))
        }</article>
    </section>
  : ""
}
